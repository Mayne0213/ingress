apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-node
  namespace: monitoring
data:
  node-exporter.json: |
    {
      "title": "Node Exporter Metrics",
      "uid": "node-exporter",
      "panels": [
        {
          "title": "CPU Usage",
          "targets": [{"expr": "100 - (avg by (instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)"}],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "type": "timeseries"
        },
        {
          "title": "Memory Usage %",
          "targets": [{"expr": "(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100"}],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "type": "timeseries"
        },
        {
          "title": "Disk Usage %",
          "targets": [{"expr": "(1 - (node_filesystem_avail_bytes{fstype!=\"tmpfs\"} / node_filesystem_size_bytes)) * 100"}],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "type": "timeseries"
        },
        {
          "title": "Network I/O",
          "targets": [
            {"expr": "rate(node_network_receive_bytes_total[5m])", "legendFormat": "RX"},
            {"expr": "rate(node_network_transmit_bytes_total[5m])", "legendFormat": "TX"}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "type": "timeseries"
        }
      ],
      "schemaVersion": 27,
      "tags": ["node", "system"]
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-ingress
  namespace: monitoring
data:
  ingress-nginx.json: |
    {
      "title": "Ingress Nginx Metrics",
      "uid": "ingress-nginx",
      "panels": [
        {
          "title": "Request Rate",
          "targets": [{"expr": "sum(rate(nginx_ingress_controller_requests[5m])) by (host)"}],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "type": "timeseries"
        },
        {
          "title": "Error Rate by Status Code",
          "targets": [{"expr": "sum(rate(nginx_ingress_controller_requests{status=~\"4..|5..\"}[5m])) by (status)"}],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "type": "timeseries"
        },
        {
          "title": "Request Duration (p95)",
          "targets": [{"expr": "histogram_quantile(0.95, sum(rate(nginx_ingress_controller_request_duration_seconds_bucket[5m])) by (le, host))"}],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "type": "timeseries"
        },
        {
          "title": "Ingress Bandwidth",
          "targets": [
            {"expr": "sum(rate(nginx_ingress_controller_request_size_sum[5m]))", "legendFormat": "Request"},
            {"expr": "sum(rate(nginx_ingress_controller_response_size_sum[5m]))", "legendFormat": "Response"}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "type": "timeseries"
        }
      ],
      "schemaVersion": 27,
      "tags": ["ingress", "nginx"]
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-argocd
  namespace: monitoring
data:
  argocd.json: |
    {
      "title": "ArgoCD Metrics",
      "uid": "argocd",
      "panels": [
        {
          "title": "Application Sync Status",
          "targets": [{"expr": "count(argocd_app_info) by (sync_status)"}],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "type": "piechart"
        },
        {
          "title": "Application Health Status",
          "targets": [{"expr": "count(argocd_app_info) by (health_status)"}],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "type": "piechart"
        },
        {
          "title": "Sync Activity",
          "targets": [{"expr": "sum(rate(argocd_app_sync_total[5m])) by (name, phase)"}],
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 8},
          "type": "timeseries"
        }
      ],
      "schemaVersion": 27,
      "tags": ["argocd", "gitops"]
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-pods
  namespace: monitoring
data:
  pod-monitoring.json: |
    {
      "title": "Pod Monitoring",
      "uid": "pod-monitoring",
      "panels": [
        {
          "title": "Pod Restart Count",
          "targets": [{"expr": "sum(kube_pod_container_status_restarts_total) by (namespace, pod)"}],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "type": "timeseries"
        },
        {
          "title": "Pod Status",
          "targets": [{"expr": "count(kube_pod_status_phase) by (phase)"}],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "type": "piechart"
        },
        {
          "title": "Container Memory Usage",
          "targets": [{"expr": "sum(container_memory_usage_bytes{container!=\"\"}) by (namespace, pod, container)"}],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "type": "timeseries"
        },
        {
          "title": "Container CPU Usage",
          "targets": [{"expr": "sum(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m])) by (namespace, pod, container)"}],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "type": "timeseries"
        }
      ],
      "schemaVersion": 27,
      "tags": ["pods", "containers"]
    }
